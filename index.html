<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>æ›¼è°·é¦™æ°›æ¼«éŠä¹‹æ—… 2026</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@300;400;600;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Noto+Sans+Thai:wght@300;400;500&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #1A1A2E; --card-color: #F5F5F0; --accent-color: #D4AF37;
            --text-on-dark: #FFFFFF; --text-on-light: #161625; --menu-bg: #131320;
            --weather-gradient: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: "Noto Serif TC", serif; background-color: var(--bg-color);
            color: var(--text-on-dark); margin: 0; padding: 0; height: 100vh;
            display: flex; flex-direction: column; overflow: hidden;
        }
        /* Header & Nav */
        header {
            padding: 15px 20px; background-color: rgba(26, 26, 46, 0.98);
            border-bottom: 1px solid rgba(212, 175, 55, 0.2); position: sticky; top: 0; z-index: 100;
            display: flex; justify-content: space-between; align-items: center; height: 60px;
        }
        header h1 { margin: 0; font-size: 1.1rem; font-family: "Playfair Display", serif; color: var(--accent-color); letter-spacing: 1px; }
        .header-icons { display: flex; gap: 18px; align-items: center; }
        .header-btn { color: var(--text-on-dark); font-size: 1.1rem; cursor: pointer; text-decoration: none; }
        
        /* Date Selector */
        .date-selector-container { background: var(--bg-color); padding: 10px 15px; border-bottom: 1px solid rgba(212, 175, 55, 0.1); }
        .date-selector { display: flex; justify-content: space-between; gap: 8px; width: 100%; }
        .date-chip {
            flex: 1; background: rgba(255,255,255,0.05); padding: 10px 5px; border-radius: 4px;
            font-size: 0.8rem; cursor: pointer; color: #aaa; display: flex; flex-direction: column; align-items: center;
        }
        .date-chip.active { background: var(--accent-color); color: #1A1A2E; font-weight: bold; }

        /* Pages */
        main { flex: 1; overflow-y: hidden; position: relative; }
        .page {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            overflow-y: auto; padding: 10px 0 90px 0; display: none; opacity: 0; transition: opacity 0.3s;
        }
        .page.active { display: block; opacity: 1; z-index: 10; }
        
        /* Itinerary Timeline */
        .timeline-container { padding: 0 20px; }
        .timeline-item { position: relative; padding-left: 25px; padding-bottom: 30px; border-left: 1px solid rgba(212, 175, 55, 0.3); }
        .timeline-item::before { content: ''; position: absolute; left: -5px; top: 18px; width: 8px; height: 8px; background: var(--bg-color); border: 2px solid var(--accent-color); transform: rotate(45deg); }

        .card { background-color: var(--card-color); color: var(--text-on-light); border-radius: 4px; padding: 16px; box-shadow: 0 4px 6px rgba(0,0,0,0.2); cursor: pointer; border-left: 4px solid var(--accent-color); }
        .card-time { font-size: 0.8rem; color: #888; font-weight: 600; display: block; margin-bottom: 4px; }
        .card-title { font-size: 1.05rem; font-weight: 700; color: #000; line-height: 1.3; margin: 0; font-family: "Playfair Display", serif; }
        .card-tag { font-size: 0.65rem; background: #e0e0e0; padding: 2px 6px; border-radius: 2px; margin-right: 4px; color: #666; }

        /* Map */
        #map-container { width: 100%; height: 100%; }

        /* Shopping List Styles */
        .shopping-day-group { margin-bottom: 25px; }
        .shopping-date-header { 
            background: linear-gradient(90deg, var(--accent-color) 0%, transparent 100%);
            color: #1A1A2E; padding: 8px 15px; font-weight: bold; font-size: 0.9rem; margin-bottom: 10px;
        }
        .shop-item { 
            background: rgba(255,255,255,0.05); padding: 15px; margin: 0 15px 10px 15px; border-radius: 6px; 
            display: flex; align-items: start; gap: 12px; border: 1px solid rgba(255,255,255,0.1);
        }
        .shop-item.checked { opacity: 0.5; }
        .shop-item.checked span { text-decoration: line-through; }
        .shop-location { font-size: 0.75rem; color: var(--accent-color); display: block; margin-bottom: 3px; }
        .shop-checkbox { 
            min-width: 20px; min-height: 20px; margin-top: 3px; accent-color: var(--accent-color); cursor: pointer;
        }

        /* Tools/Utilities */
        .budget-card { background: var(--weather-gradient); padding: 20px; border-radius: 12px; text-align: center; margin-bottom: 20px; position: relative; }
        .budget-amount { font-size: 2rem; font-weight: bold; color: var(--accent-color); }
        .reset-btn { position: absolute; top: 10px; right: 10px; background: none; border: none; color: rgba(255,255,255,0.5); font-size: 0.8rem; cursor: pointer; }

        /* Modals */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 3000; justify-content: center; align-items: end; backdrop-filter: blur(5px); }
        .modal.open { display: flex; }
        .modal-content { background: var(--card-color); color: var(--text-on-light); width: 100%; max-width: 600px; max-height: 85vh; border-radius: 12px 12px 0 0; padding: 25px; overflow-y: auto; position: relative; }
        .close-modal { position: absolute; top: 15px; right: 20px; font-size: 1.8rem; color: #888; cursor: pointer; }

        .taxi-card { 
            background: #fff; color: #000; padding: 15px; border: 3px solid var(--accent-color); 
            margin: 15px 0; text-align: center; border-radius: 4px; 
            display: none; /* Default hidden */
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        
        .thai-font { font-family: "Noto Sans Thai", sans-serif; font-weight: 500; }
        .note-box { background: #fdfdfd; border-left: 4px solid var(--accent-color); padding: 15px; margin: 15px 0; font-size: 0.95rem; color: #333; line-height: 1.6; }

        /* Sub Pages */
        .sub-page { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--bg-color); z-index: 2000; display: flex; flex-direction: column; transform: translateX(100%); transition: transform 0.3s; }
        .sub-page.open { transform: translateX(0); }
        .sub-header { padding: 15px 20px; background: var(--menu-bg); border-bottom: 1px solid rgba(212,175,55,0.2); display: flex; align-items: center; gap: 15px; }
        
        .checklist-item { background: rgba(255,255,255,0.05); padding: 15px; margin-bottom: 10px; border-radius: 4px; display: flex; align-items: center; gap: 12px; cursor: pointer; }
        .action-btn { display: flex; justify-content: center; align-items: center; gap: 8px; width: 100%; padding: 14px; margin-top: 10px; background: #1A1A2E; color: var(--accent-color); border-radius: 4px; font-weight: bold; border: 1px solid var(--accent-color); }

        /* Bottom Nav */
        nav.bottom-nav { position: fixed; bottom: 0; width: 100%; background-color: var(--menu-bg); display: flex; justify-content: space-around; padding: 10px 0 25px 0; border-top: 1px solid rgba(212, 175, 55, 0.2); z-index: 100; }
        .nav-item { color: #666; text-align: center; font-size: 0.75rem; width: 25%; cursor: pointer; }
        .nav-item.active { color: var(--accent-color); }
        .nav-item i { font-size: 1.2rem; margin-bottom: 4px; display: block; }
    </style>
</head>
<body>

    <header>
        <h1>æ›¼è°·é¦™æ°›æ¼«éŠä¹‹æ—…</h1>
        <div class="header-icons">
            <a href="https://translate.google.com" target="_blank" class="header-btn"><i class="fa-solid fa-language"></i></a>
            <a href="#" class="header-btn" onclick="openTipsModal()"><i class="fa-solid fa-map-signs"></i></a>
            <a href="#" class="header-btn" onclick="switchMainPage('tools')"><i class="fa-solid fa-toolbox"></i></a>
        </div>
    </header>

    <div class="date-selector-container">
        <div class="date-selector" id="date-selector"></div>
    </div>

    <main>
        <div id="page-itinerary" class="page active"><div class="timeline-container" id="timeline-container"></div></div>
        
        <div id="page-map" class="page"><div id="map-container"></div></div>
        
        <div id="page-shopping" class="page">
            <div style="padding-bottom: 20px;">
                <div style="padding: 20px 20px 0 20px;">
                    <h2 style="font-family:'Playfair Display'; text-align:center; color:var(--accent-color);">Shopping List</h2>
                    <p style="text-align:center; font-size:0.8rem; color:#888; margin-top:-10px;">é¦™æ°›èˆ‡æ¼«éŠçš„æˆ°åˆ©å“</p>
                </div>
                <div id="shopping-container"></div>
            </div>
        </div>

        <div id="page-weather" class="page">
            <div style="padding: 20px;">
                <h2 style="font-family:'Playfair Display',serif; text-align:center;">Bangkok Weather</h2>
                <div class="note-box" style="text-align:center; background:var(--weather-gradient); color:#fff; border:none;">
                    <i class="fa-solid fa-sun" style="font-size:3rem; margin-bottom:10px;"></i><br>
                    <span style="font-size:2.5rem;">39Â°C</span><br>å¾©æ´»ç¯€é…·æš‘æœŸ (é¿æš‘å»ºè­° 14-16:00)
                </div>
                <div class="checklist-item" style="cursor:default;">
                    <span>æ¯æ—¥è£œæ°´è¨ˆæ•¸å™¨ (å»ºè­° 8 æ¯)</span>
                    <button onclick="updateCounter('water', 1)" style="margin-left:auto; background:var(--accent-color); border:none; width:45px; height:45px; border-radius:50%; font-size:1.2rem;"><i class="fa-solid fa-plus"></i></button>
                    <span id="water-count" style="margin-left:15px; font-size:1.5rem;">0</span>
                </div>
            </div>
        </div>

        <div id="page-tools" class="page">
            <div style="padding: 20px;">
                <h2 style="text-align:center; font-family:'Playfair Display'; margin-bottom:20px;">Utilities</h2>
                <div class="budget-card">
                    <button class="reset-btn" onclick="resetBudget()"><i class="fa-solid fa-rotate-right"></i> é‡ç½®</button>
                    <p style="margin:0; font-size:0.9rem;">è¡Œç¨‹ç¸½èŠ±è²»é ç®— (THB)</p>
                    <div class="budget-amount" id="budget-display">0</div>
                    <p style="font-size:0.7rem; color:rgba(255,255,255,0.6)">é ä¼°å»ºè­°ï¼šà¸¿30,000+</p>
                    <button onclick="addExpense()" style="margin-top:10px; background:none; border:1px solid #fff; color:#fff; padding:5px 15px; border-radius:20px;">+ è¨˜éŒ„ (è¼¸å…¥è² æ•¸æ‰£é™¤)</button>
                </div>
                <div class="checklist-item" onclick="openSubPage('hotel')"><i class="fa-solid fa-hotel"></i> é£¯åº—è³‡è¨Š & æ³°æ–‡åœ°å€</div>
                <div class="checklist-item" onclick="openSubPage('packing')"><i class="fa-solid fa-suitcase"></i> è¡Œæ Check-list</div>
                <div class="checklist-item" onclick="openSubPage('rate')"><i class="fa-solid fa-coins"></i> åŒ¯ç‡æ›ç®— (THB/HKD)</div>
                <div class="checklist-item" onclick="sendSafety()"><i class="fa-brands fa-whatsapp"></i> WhatsApp å ±å¹³å®‰</div>
            </div>
        </div>

        <div id="subpage-hotel" class="sub-page">
            <div class="sub-header"><button onclick="closeSubPage('hotel')" style="background:none; border:none; color:var(--accent-color); font-size:1.2rem;"><i class="fa-solid fa-arrow-left"></i></button><h2>é£¯åº—è©³ç´°è³‡è¨Š</h2></div>
            <div style="padding:20px;">
                <h3 style="color:var(--accent-color);">IR-ON Hotel (Thong Lo)</h3>
                <div class="note-box thai-font" style="background:#fff; border:2px solid var(--accent-color); color:#000; font-size:1.1rem;">à¹‚à¸£à¸‡à¹à¸£à¸¡ à¹„à¸­à¸­à¸­à¸™, 10/10 à¸‹à¸­à¸¢à¸ªà¸¸à¸‚à¸¸à¸¡à¸§à¸´à¸— 36, à¸à¸£à¸‡à¹€à¸—à¸à¸¯</div>
                <p><b>å…¥ä½ï¼š</b>14:00 | <b>é€€æˆ¿ï¼š</b>12:00</p>
                <div class="note-box">
                    <b>ğŸ  é˜²è¿·è·¯å›ç¨‹æŒ‡å¼•ï¼š</b><br>
                    1. æŠµé” <b>BTS Thong Lo (E6)</b>ã€‚<br>
                    2. èµ° <b>2 è™Ÿå‡ºå£</b> ä¸‹æ¨“ã€‚<br>
                    3. ä¸‹æ¨“å¾Œç«‹åˆ»ã€Œ180 åº¦å¤§è¿´è½‰ã€å¾€ Asok æ–¹å‘èµ°ã€‚<br>
                    4. æ­¥è¡Œ 30m è½‰é€²å·¦æ‰‹é‚Š <b>Soi 36</b>ã€‚<br>
                    5. ç›´è¡Œç´„ 350m (ç´„ 4 åˆ†é˜)ï¼Œé£¯åº—åœ¨å³å´é»‘è‰²å·¥æ¥­é¢¨å»ºç¯‰ã€‚
                </div>
            </div>
        </div>
        
        <div id="subpage-packing" class="sub-page">
            <div class="sub-header"><button onclick="closeSubPage('packing')" style="background:none; border:none; color:var(--accent-color); font-size:1.2rem;"><i class="fa-solid fa-arrow-left"></i></button><h2>è¡Œææ¸…å–®</h2></div>
            <div id="packing-list-container" style="padding:20px;"></div>
        </div>

        <div id="subpage-rate" class="sub-page">
            <div class="sub-header"><button onclick="closeSubPage('rate')" style="background:none; border:none; color:var(--accent-color); font-size:1.2rem;"><i class="fa-solid fa-arrow-left"></i></button><h2>åŒ¯ç‡æ›ç®—</h2></div>
            <div style="padding:20px;">
                <label>æ³°éŠ– (THB)</label><input type="number" id="thb-input" oninput="calcRate('thb')" style="width:100%; padding:15px; margin:10px 0; background:#333; color:#fff; border:none; border-radius:8px; font-size:1.2rem;">
                <label>æ¸¯å¹£ (HKD)</label><input type="number" id="hkd-input" oninput="calcRate('hkd')" style="width:100%; padding:15px; margin:10px 0; background:#333; color:#fff; border:none; border-radius:8px; font-size:1.2rem;">
                <p style="font-size:0.8rem; color:#888;">é è¨­åŒ¯ç‡: 1 THB = 0.23 HKD</p>
            </div>
        </div>
    </main>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="switchMainPage('itinerary', this)"><i class="fa-solid fa-calendar-days"></i> è¡Œç¨‹</div>
        <div class="nav-item" onclick="switchMainPage('map', this)"><i class="fa-solid fa-map-location-dot"></i> åœ°åœ–</div>
        <div class="nav-item" onclick="switchMainPage('weather', this)"><i class="fa-solid fa-cloud-sun-rain"></i> å¤©æ°£</div>
        <div class="nav-item" onclick="switchMainPage('shopping', this)"><i class="fa-solid fa-bag-shopping"></i> è³¼ç‰©</div>
    </nav>

    <div id="detail-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">Ã—</span>
            <h2 id="modal-title" style="font-family:'Playfair Display',serif; color:#000; margin-bottom:15px; padding-right:30px;"></h2>
            
            <div id="taxi-card-box" class="taxi-card">
                <p style="font-size:0.8rem; color:#888; margin-bottom:5px;">çµ¦å¸æ©Ÿçœ‹ (Thai Address):</p>
                <div id="modal-thai-address" class="thai-font" style="font-size:1.3rem; line-height:1.4; color:#000;"></div>
            </div>

            <div style="font-size:0.9rem; margin-bottom:15px; color:#333;">
                <div><i class="fa-regular fa-clock" style="color:var(--accent-color)"></i> <span id="modal-stay"></span></div>
                <div style="color:#B71C1C; margin-top:5px;"><i class="fa-solid fa-door-open"></i> <b>ç‡Ÿæ¥­ï¼š</b> <span id="modal-open"></span></div>
            </div>
            <div class="note-box" id="modal-note"></div>
            <div style="display:flex; gap:10px;">
                <button class="action-btn" id="modal-map-btn" style="flex:1;"><i class="fa-solid fa-location-arrow"></i> å°èˆª</button>
                <button class="action-btn" id="modal-taxi-btn" onclick="toggleTaxi()" style="flex:1; background:#fff; color:#000; border-color:#ccc;"><i class="fa-solid fa-taxi"></i> åœ°å€å¡</button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const scheduleData = {
            "day1": { 
                "date": "4/3 (äº”)", 
                "events": [
                    { time: "10:30", title: "æŠµé”æ›¼è°· (BKK)", stay: "ARL æ©Ÿå ´å¿«ç·š", open: "24H", address: "BKK Airport", thai: "à¸ªà¸™à¸²à¸¡à¸šà¸´à¸™à¸ªà¸¸à¸§à¸£à¸£à¸“à¸ à¸¹à¸¡à¸´", coords: [13.6899, 100.7501], note: "1. B1 æ­ ARL åˆ° Phaya Thai (à¸¿45)ã€‚<br>2. è½‰ BTS å¾€ Kheha æ–¹å‘åˆ° Thong Loã€‚<br>3. é£¯åº— IR-ON åœ¨ 2 è™Ÿå‡ºå£è¿´è½‰é€²å…¥ Soi 36ã€‚", tags: ["äº¤é€š"] },
                    { time: "13:00", title: "åˆé¤ï¼šSupanniga Eating Room", stay: "13:00 - 14:30", open: "10:00 - 22:00", address: "Supanniga Eating Room Thong Lo", thai: "à¸ªà¸¸à¸à¸£à¸£à¸“à¸´à¸à¸²à¸£à¹Œ à¸­à¸µà¸—à¸•à¸´à¹‰à¸‡ à¸£à¸¹à¸¡ à¸—à¸­à¸‡à¸«à¸¥à¹ˆà¸­", coords: [13.7314, 100.5815], note: "<b>ç±³å…¶æ—æ¨è–¦</b>ã€‚æ¨è–¦ï¼šèŸ¹è‚‰çƒ˜è›‹ã€é¦¬æ’’æ›¼å’–å“©ç‰›ã€‚", tags: ["ç±³å…¶æ—"] },
                    { time: "15:00", title: "Jim Thompson House", stay: "15:00 - 16:30", open: "10:00 - 18:00", address: "Jim Thompson House Museum", thai: "à¸à¸´à¸à¸´à¸˜à¸ à¸±à¸“à¸‘à¹Œà¸šà¹‰à¸²à¸™à¸ˆà¸´à¸¡ à¸—à¸­à¸¡à¸›à¹Œà¸ªà¸±à¸™", coords: [13.7495, 100.5283], note: "æ³°çµ²å¤§ç‹æŸšæœ¨å»ºç¯‰ã€‚é–€ç¥¨ à¸¿200ã€‚", tags: ["æ–‡åŒ–"] },
                    { time: "16:30", title: "é¦™æ°›å·¡ç¦®ï¼šJournal & Copenn.", stay: "Siam Square å€", open: "10:00 - 21:00", address: "Siam Square One", thai: "à¸ªà¸¢à¸²à¸¡à¸ªà¹à¸„à¸§à¸£à¹Œà¸§à¸±à¸™", coords: [13.7445, 100.5342], note: "<b>Journal (LGå±¤):</b> å¿…è©¦æ²‰é¦™ã€èŠ’æœç³¯ç±³é¦™æ°´ã€‚<br><b>Copenn (Firsterå…§):</b> æ¥µç°¡é¢¨è­·æ‰‹éœœæ¨è–¦ã€‚", tags: ["è³¼ç‰©", "é¦™æ°›"] },
                    { time: "18:30", title: "æ™šé¤ï¼šSra Bua by Kiin Kiin", stay: "18:30 - 20:30", open: "18:00 - 24:00", address: "Siam Kempinski Hotel", thai: "à¸ªà¸£à¸°à¸šà¸±à¸§ à¸šà¸²à¸¢ à¸à¸´à¸™ à¸à¸´à¸™", coords: [13.7473, 100.5342], note: "<b>ç±³å…¶æ—ä¸€æ˜Ÿ</b>ã€‚åˆ†å­æ³°èœã€‚éœ€é ç´„ï¼ŒSmart Casualã€‚", tags: ["ç±³å…¶æ—"] },
                    { time: "21:00", title: "æŒ‰æ‘©ï¼šAsia Herb (Thong Lo)", stay: "21:00 - 22:30", open: "09:00 - 02:00", address: "Asia Herb Association Thong Lo", thai: "à¹€à¸­à¹€à¸Šà¸µà¸¢ à¹€à¸®à¸´à¸£à¹Œà¸š à¹à¸­à¸ªà¹‚à¸‹à¸‹à¸´à¹€à¸­à¸Šà¸±à¹ˆà¸™", coords: [13.7255, 100.5785], note: "é€šç¾…ç«™ 3 è™Ÿå‡ºå£å³é”ã€‚æ¨è–¦ 100% ç´”ç²¾æ²¹æŒ‰æ‘©ã€‚", tags: ["Spa"] }
                ],
                "shopping": [
                    { item: "Journal æ²‰é¦™/èŠ’æœç³¯ç±³é¦™æ°´", loc: "Siam Square One LG" },
                    { item: "Copenn. è­·æ‰‹éœœ & ç·šé¦™", loc: "Siam Square Firster" },
                    { item: "æ³°çµ²è£½å“ (è‹¥å–œæ­¡)", loc: "Jim Thompson Store" }
                ]
            },
            "day2": { 
                "date": "4/4 (å…­)", 
                "events": [
                    { time: "10:00", title: "Chatuchak é€±æœ«å¸‚é›†", stay: "å¤è‘£ & Hem Aroma", open: "09:00 - 18:00", address: "Chatuchak Weekend Market Section 26", thai: "à¸•à¸¥à¸²à¸”à¸™à¸±à¸”à¸ˆà¸•à¸¸à¸ˆà¸±à¸à¸£", coords: [13.8015, 100.5524], note: "ç›´è¡ Section 26 å°‹å¤ç‰©ã€‚<b>Hem Aroma</b> äº¦åœ¨ Sec 26ï¼Œå¿…è²·é¦™æ°›æœ¨ã€‚", tags: ["å¸‚é›†"] },
                    { time: "12:30", title: "Copper Beyond Buffet", stay: "å’Œç‰›èˆ¹éºµ & é»‘æ¾éœ²", open: "10:00 - 20:00", address: "Gaysorn Amarin", thai: "à¸„à¸­à¸›à¹€à¸›à¸­à¸£à¹Œ à¸šà¸µà¸¢à¸­à¸™à¸”à¹Œ à¸šà¸¸à¸Ÿà¹€à¸Ÿà¸•à¹Œ", coords: [13.7445, 100.5410], note: "é è¨‚åˆ¶ã€‚ä¸»æ”»å’Œç‰›èˆ¹éºµã€æ¾éœ²æ¿ƒæ¹¯ã€‚é ç®— à¸¿2,000ã€‚", tags: ["å¿…åƒ"] },
                    { time: "15:00", title: "é£¯åº—é¿æš‘åˆä¼‘", stay: "é¿æš‘æ™‚æ®µ", note: "å¾©æ´»ç¯€é…·æš‘æœŸï¼Œå…¨å¤©æœ€ç†±æ™‚æ®µå› IR-ON ä¼‘æ¯ã€‚", tags: ["é¿æš‘"] },
                    { time: "16:30", title: "æŒ‰æ‘©ï¼šAsia Herb (è‰è—¥çƒ)", stay: "16:30 - 18:00", note: "æ¨è–¦ï¼šæ³°å¼æŒ‰æ‘©+ç”Ÿè‰è—¥çƒç†±æ•·ã€‚", tags: ["Spa"] },
                    { time: "18:30", title: "Mae Varee èŠ’æœç³¯ç±³é£¯", stay: "é€šç¾…å¿…åƒè€åº—", open: "06:00 - 22:00", address: "Mae Varee Mango Sticky Rice", thai: "à¹à¸¡à¹ˆà¸§à¸²à¸£à¸µ à¸—à¸­à¸‡à¸«à¸¥à¹ˆà¸­", note: "3 è™Ÿå‡ºå£ä¸‹æ¨“å³é”ã€‚å¤–å¸¶å›é£¯åº—ã€‚", tags: ["å°åƒ"] },
                    { time: "19:30", title: "Paper Plane Project", stay: "40F é«˜ç©ºç”Ÿå•¤", open: "09:00 - 01:30", address: "T-One Building", thai: "à¸•à¸¶à¸ à¸—à¸µ-à¸§à¸±à¸™ à¸Šà¸±à¹‰à¸™ 40", coords: [13.7225, 100.5785], note: "æ­¥è¡Œ 3 åˆ†é˜ã€‚æ™¯è§€æ¥µç¾ï¼Œæ¨è–¦æ³°åœ‹æœ¬åœŸç”Ÿå•¤ã€‚", tags: ["é…’å§"] }
                ],
                "shopping": [
                    { item: "Hem Aroma é¦™æ°›æœ¨/ç²¾æ²¹", loc: "Chatuchak Sec 26" },
                    { item: "å¤è‘£/äºŒæ‰‹é¸ç‰©", loc: "Chatuchak Sec 26" },
                    { item: "æ‰‹å·¥é£¾å“/æ–‡å‰µå°ç‰©", loc: "Chatuchak" }
                ]
            },
            "day3": { 
                "date": "4/5 (æ—¥)", 
                "events": [
                    { time: "09:30", title: "è˜‡æ³°å¯º Wat Suthat", stay: "æ™¨é–“ç¥ˆç¦", open: "08:00 - 20:00", address: "Wat Suthat", thai: "à¸§à¸±à¸”à¸ªà¸¸à¸—à¸±à¸¨à¸™à¹€à¸—à¸à¸§à¸£à¸²à¸£à¸²à¸¡", coords: [13.7510, 100.5011], note: "ä¸€ç´šçš‡å®¶å¯ºå»Ÿï¼Œç´…è‰²å¤§é¦éŸ†æ—ã€‚", tags: ["å¯ºå»Ÿ"] },
                    { time: "12:00", title: "åˆé¤ï¼šThe Mustang Blu", stay: "ç™¾å¹´å»ºç¯‰è—è¡“", open: "11:00 - 21:00", address: "The Mustang Blu", thai: "à¹€à¸”à¸­à¸° à¸¡à¸±à¸ªà¹à¸•à¸‡ à¸šà¸¥à¸¹", coords: [13.7395, 100.5160], note: "MRT Hua Lamphong 2 è™Ÿå‡ºå£æ­¥ 5 åˆ†ã€‚å¿…é»é»‘æ¾éœ²ç¾©å¤§åˆ©éºµã€‚", tags: ["é¤å»³"] },
                    { time: "14:30", title: "River City Bangkok", stay: "è—è¡“ & å¤è‘£", open: "10:00 - 20:00", address: "River City Bangkok", thai: "à¸£à¸´à¹€à¸§à¸­à¸£à¹Œ à¸‹à¸´à¸•à¸µà¹‰ à¹à¸šà¸‡à¸„à¹‡à¸­à¸", coords: [13.7303, 100.5135], note: "3-4 æ¨“å¤è‘£æ‹è³£ä¸­å¿ƒèˆ‡ç•«å»Šã€‚å˜Ÿå˜Ÿè»Šå‰å¾€ç´„ à¸¿100ã€‚", tags: ["è—è¡“"] },
                    { time: "18:30", title: "æ™šé¤ï¼šPaste Bangkok", stay: "çš‡å®¶å’–å“©èŸ¹", open: "18:00 - 23:00", address: "Gaysorn Village", thai: "à¹€à¸à¸ªà¸•à¹Œ à¹à¸šà¸‡à¸„à¹‡à¸­à¸", note: "<b>ç±³å…¶æ—ä¸€æ˜Ÿ</b>ã€‚çš‡å®¤æ³°èœã€‚å¿…é»çš‡å®¶å’–å“©èŸ¹ã€‚", tags: ["ç±³å…¶æ—"] },
                    { time: "21:00", title: "æŒ‰æ‘©ï¼šAsia Herb (è‚©é ¸)", stay: "æ”¾é¬†ä»Šæ—¥è…³ç¨‹", note: "æ¨è–¦é ­ã€è‚©ã€èƒŒæŒ‰æ‘©ã€‚", tags: ["Spa"] }
                ],
                "shopping": [
                    { item: "è—è¡“æ˜ä¿¡ç‰‡/ç•«ä½œ", loc: "River City" },
                    { item: "ç‰¹è‰²å¤ç© (ç´”æ¬£è³æˆ–æ”¶è—)", loc: "River City 4F" }
                ]
            },
            "day4": { 
                "date": "4/6 (ä¸€)", 
                "events": [
                    { time: "10:30", title: "Erb Bespoke èª¿é¦™é«”é©—", stay: "å°ˆå±¬é¦™æ°´è¨‚è£½", open: "10:00 - 20:00", address: "Erb Boutique Gaysorn", thai: "à¹€à¸­à¸´à¸š à¹€à¸šà¸ªà¹‚à¸›à¸„ (à¹€à¸à¸©à¸£à¸§à¸´à¸¥à¹€à¸¥à¸ˆ)", note: "éœ€é ç´„ã€‚èª¿è£½å°ˆå±¬å€‹äººåå­—çš„é¦™æ°´ BARã€‚", tags: ["é«”é©—"] },
                    { time: "12:30", title: "Copper Beyond Buffet (R2)", stay: "äºŒåˆ·ç”Ÿè ”", open: "10:00 - 20:00", note: "äºŒåˆ·æ”»ç•¥ï¼šå°ˆæ”»ç”Ÿè ”ã€æ³°å¼ç”Ÿé†ƒåŠç²¾ç·»ç”œé»ã€‚", tags: ["Buffet"] },
                    { time: "15:00", title: "Gourmet Market æ¡è³¼", stay: "EmQuartier åº—", open: "10:00 - 22:00", address: "EmQuartier", thai: "à¸à¸¹à¸£à¹Œà¹€à¸¡à¸•à¹Œ à¸¡à¸²à¸£à¹Œà¹€à¸à¹‡à¸•", coords: [13.7315, 100.5695], note: "1 è™Ÿå‡ºå£ç›´é€šã€‚è²·ä¼´æ‰‹ç¦®æœ€ä½³åœ°é»ã€‚", tags: ["è¶…å¸‚"] },
                    { time: "16:30", title: "æŒ‰æ‘©ï¼šAsia Herb (å¤§ä¿é¤Š)", stay: "æœ€å¾Œä¸€æ™šæ·±åº¦æ”¾é¬†", note: "å…¨èº«ç²¾æ²¹+è‰è—¥çƒ (120åˆ†é˜)ã€‚", tags: ["Spa"] },
                    { time: "19:00", title: "The Commons Thong Lo", stay: "æ–‡é’å•¤é…’ç¤¾å€", open: "08:00 - 01:00", address: "The Commons Thong Lo", thai: "à¹€à¸”à¸­à¸° à¸„à¸­à¸¡à¸¡à¸­à¸™à¸ªà¹Œ à¸—à¸­à¸‡à¸«à¸¥à¹ˆà¸­", note: "è·¯å£æ­ç´…è‰²å°å·´ (à¸¿8)ã€‚å» The Beer Cap å–ç²¾é‡€ã€‚", tags: ["æ–‡é’"] }
                ],
                "shopping": [
                    { item: "Erb è¨‚è£½é¦™æ°´", loc: "Gaysorn Village" },
                    { item: "è—è±¡èª¿ç†åŒ…/æ³°å¼é†¬æ–™", loc: "Gourmet Market" },
                    { item: "ChaTraMue æ‰‹æ¨™èŒ¶è‘‰", loc: "Gourmet Market" },
                    { item: "æ³°åœ‹æ°´æœä¹¾ (èŠ’æœ/æ¦´æ§¤)", loc: "Gourmet Market" },
                    { item: "æ¤°å­æ²¹/Spa ç”¢å“è£œè²¨", loc: "Gourmet Market" }
                ]
            },
            "day5": { 
                "date": "4/7 (äºŒ)", 
                "events": [
                    { time: "09:30", title: "æ„›ç¥ & è±¡ç¥ç¥ˆç¦", stay: "Central World å»£å ´", open: "24H", address: "Central World Shrine", thai: "à¸à¸£à¸°à¸•à¸£à¸µà¸¡à¸¹à¸£à¸•à¸´ à¹€à¸‹à¹‡à¸™à¸—à¸£à¸±à¸¥à¹€à¸§à¸´à¸¥à¸”à¹Œ", note: "ç´…ç«ç‘°æ±‚ç·£åˆ†ï¼Œè±¡ç¥æ±‚äº‹æ¥­é †åˆ©ã€‚", tags: ["ç¥ˆç¦"] },
                    { time: "11:30", title: "åˆé¤ï¼šSaneh Jaan", stay: "æœ€çµ‚å›ç±³å…¶æ—", open: "11:30 - 14:00", address: "Sindhorn Tower", thai: "à¹€à¸ªà¸™à¹ˆà¸«à¹Œà¸ˆà¸±à¸™à¸—à¸™à¹Œ", coords: [13.7385, 100.5448], note: "<b>ç±³å…¶æ—ä¸€æ˜Ÿ</b>ã€‚å®®å»·æ³°å¼æ‹¼ç›¤ã€‚", tags: ["ç±³å…¶æ—"] },
                    { time: "14:30", title: "å‰å¾€æ©Ÿå ´ (BKK)", stay: "æå‰ 3 å°æ™‚æŠµé”", note: "è¿”é£¯åº—å–è¡Œæã€‚æ­ BTS åˆ° Phaya Thai è½‰ ARL å¾€æ©Ÿå ´ã€‚", tags: ["å›ç¨‹"] }
                ],
                "shopping": [
                    { item: "æ©Ÿå ´å…ç¨…åº— (Jo Malone/é…’)", loc: "BKK Airport" },
                    { item: "æœ€å¾Œé›¶é£Ÿè£œçµ¦", loc: "BKK Airport 7-11" }
                ]
            }
        };

        const packingListItems = ["è­·ç…§/ç°½è­‰", "ç¶²å¡/E-SIM", "é˜²èšŠæ¶²/é˜²æ›¬", "è–„æŠ«è‚©(å¯ºå»Ÿ/å†·æ°£)", "Rabbit Card", "æ­¢ç€‰/å¸¸ç”¨è—¥", "è¡Œå‹•é›»æº", "Hungry Hub é ç´„è­‰æ˜"];
        let map, markers = [], waterCount = 0, expenseTotal = 0;

        function init() {
            renderDateSelector();
            autoSelectDate();
            renderPacking();
            renderShopping();
            initMap();
            
            waterCount = parseInt(localStorage.getItem('waterCount')) || 0;
            expenseTotal = parseInt(localStorage.getItem('expenseTotal')) || 0;
            
            document.getElementById('water-count').innerText = waterCount;
            document.getElementById('budget-display').innerText = expenseTotal.toLocaleString();
        }

        function autoSelectDate() {
            // è‡ªå‹•è·³è½‰é‚è¼¯
            selectDay('day1', document.querySelector('.date-chip'));
        }

        function renderDateSelector() {
            const container = document.getElementById('date-selector');
            Object.keys(scheduleData).forEach(dayKey => {
                const chip = document.createElement('div');
                chip.className = `date-chip`;
                chip.onclick = () => selectDay(dayKey, chip);
                chip.innerHTML = `<span class="day-num">D${dayKey.replace('day','')}</span><span style="font-size:0.65rem;">${scheduleData[dayKey].date.split(' ')[0]}</span>`;
                container.appendChild(chip);
            });
        }

        function selectDay(dayKey, chipEl) {
            document.querySelectorAll('.date-chip').forEach(c => c.classList.remove('active'));
            chipEl.classList.add('active');
            renderTimeline(dayKey);
            if(map) updateMapMarkers(dayKey);
        }

        function renderTimeline(dayKey) {
            const container = document.getElementById('timeline-container');
            container.innerHTML = `<h3 style="color:var(--accent-color); margin-bottom:15px;">${scheduleData[dayKey].date}</h3>`;
            scheduleData[dayKey].events.forEach((ev, index) => {
                container.innerHTML += `
                    <div class="timeline-item">
                        <div class="card" onclick="openEventModalByRef('${dayKey}', ${index})">
                            <span class="card-time">${ev.time}</span>
                            <h3 class="card-title">${ev.title}</h3>
                            <div class="tags">${ev.tags.map(t => `<span class="card-tag">${t}</span>`).join('')}</div>
                        </div>
                    </div>`;
            });
        }

        function renderShopping() {
            const container = document.getElementById('shopping-container');
            container.innerHTML = '';
            
            Object.keys(scheduleData).forEach(dayKey => {
                const dayData = scheduleData[dayKey];
                if(dayData.shopping && dayData.shopping.length > 0) {
                    let html = `<div class="shopping-day-group">
                        <div class="shopping-date-header">${dayData.date} - ${dayData.shopping[0].loc.split(' ')[0]}å‘¨é‚Š</div>`;
                    
                    dayData.shopping.forEach((shop, idx) => {
                        const id = `shop-${dayKey}-${idx}`;
                        const isChecked = localStorage.getItem(id) === 'true' ? 'checked' : '';
                        html += `
                            <div class="shop-item ${isChecked}" id="item-${id}">
                                <input type="checkbox" class="shop-checkbox" id="${id}" ${isChecked ? 'checked' : ''} onchange="toggleShop('${id}')">
                                <div>
                                    <span class="shop-location">${shop.loc}</span>
                                    <span>${shop.item}</span>
                                </div>
                            </div>`;
                    });
                    html += `</div>`;
                    container.innerHTML += html;
                }
            });
        }

        function toggleShop(id) {
            const el = document.getElementById(id);
            const itemDiv = document.getElementById(`item-${id}`);
            if(el.checked) {
                itemDiv.classList.add('checked');
                localStorage.setItem(id, 'true');
            } else {
                itemDiv.classList.remove('checked');
                localStorage.removeItem(id);
            }
        }

        function openEventModalByRef(dayKey, index) {
            const ev = scheduleData[dayKey].events[index];
            document.getElementById('modal-title').innerText = ev.title;
            document.getElementById('modal-stay').innerText = ev.stay;
            document.getElementById('modal-open').innerText = ev.open || "è¦‹å‚™è¨»";
            
            // è™•ç†æ³°æ–‡åœ°å€èˆ‡å¸æ©Ÿå¡
            const thaiAddr = ev.thai || ev.address || "";
            document.getElementById('modal-thai-address').innerText = thaiAddr;
            
            // é‡è¦ï¼šé è¨­éš±è—å¸æ©Ÿå¡
            const taxiBox = document.getElementById('taxi-card-box');
            taxiBox.style.display = 'none';

            // åªæœ‰ç•¶æœ‰æ³°æ–‡åœ°å€æ™‚ï¼Œæ‰é¡¯ç¤ºã€Œåœ°å€å¡ã€æŒ‰éˆ•
            const taxiBtn = document.getElementById('modal-taxi-btn');
            if (thaiAddr) {
                taxiBtn.style.display = 'flex';
            } else {
                taxiBtn.style.display = 'none';
            }
            
            document.getElementById('modal-note').innerHTML = ev.note;
            document.getElementById('detail-modal').classList.add('open');
            
            // å°èˆªé€£çµ
            let mapUrl;
            if (ev.coords) {
                mapUrl = `https://www.google.com/maps/search/?api=1&query=${ev.coords[0]},${ev.coords[1]}`;
            } else {
                mapUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(ev.address || ev.title)}`;
            }
            document.getElementById('modal-map-btn').onclick = () => window.open(mapUrl);
        }

        function toggleTaxi() {
            const box = document.getElementById('taxi-card-box');
            // åˆ‡æ›é¡¯ç¤º/éš±è—
            box.style.display = box.style.display === 'none' ? 'block' : 'none';
        }

        function closeModal() { document.getElementById('detail-modal').classList.remove('open'); }

        function renderPacking() {
            const c = document.getElementById('packing-list-container'); c.innerHTML = '';
            packingListItems.forEach(item => c.innerHTML += `<div class="checklist-item"><input type="checkbox"> <span>${item}</span></div>`);
        }

        function initMap() {
            map = L.map('map-container').setView([13.746, 100.534], 13);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);
            
            const locateBtn = L.control({position: 'topright'});
            locateBtn.onAdd = function () {
                const div = L.DomUtil.create('div', 'leaflet-bar leaflet-control leaflet-control-custom');
                div.innerHTML = '<div style="background:#fff; padding:5px; cursor:pointer;" onclick="map.locate({setView: true, maxZoom: 15})"><i class="fa-solid fa-crosshairs" style="color:#333; font-size:1.2rem;"></i></div>';
                return div;
            };
            locateBtn.addTo(map);
            
            map.on('locationfound', function(e) {
                L.marker(e.latlng).addTo(map).bindPopup("ä½ åœ¨é€™è£¡").openPopup();
                L.circle(e.latlng, e.accuracy/2).addTo(map);
            });
        }

        function updateMapMarkers(dayKey) {
            markers.forEach(m => map.removeLayer(m)); markers = [];
            const group = new L.featureGroup();
            scheduleData[dayKey].events.forEach(ev => {
                if(ev.coords) {
                    const m = L.marker(ev.coords).addTo(map).bindPopup(ev.title);
                    markers.push(m); group.addLayer(m);
                }
            });
            if(markers.length > 0) map.fitBounds(group.getBounds(), {padding: [50, 50]});
        }

        function switchMainPage(id, el) {
            if(id === 'tools') {
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.getElementById('page-tools').classList.add('active');
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                return;
            }

            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + id).classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            if(el && el.classList.contains('nav-item')) el.classList.add('active');
            
            if(id === 'map') setTimeout(() => map.invalidateSize(), 300);
        }

        function calcRate(type) {
            const rate = 0.23;
            const thb = document.getElementById('thb-input'); const hkd = document.getElementById('hkd-input');
            if(type==='thb') hkd.value = (thb.value * rate).toFixed(2); else thb.value = (hkd.value / rate).toFixed(0);
        }

        function updateCounter(type, val) {
            if(type === 'water') {
                waterCount += val;
                document.getElementById('water-count').innerText = waterCount;
                localStorage.setItem('waterCount', waterCount);
            }
        }

        function addExpense() {
            const amountStr = prompt("è¼¸å…¥æ”¯å‡ºé‡‘é¡ (THB)\n- è¼¸å…¥æ•¸å­—å¢åŠ \n- è¼¸å…¥è² æ•¸(å¦‚ -500)å¯æ‰£é™¤:");
            if (amountStr && !isNaN(amountStr)) {
                expenseTotal += parseInt(amountStr);
                if(expenseTotal < 0) expenseTotal = 0;
                document.getElementById('budget-display').innerText = expenseTotal.toLocaleString();
                localStorage.setItem('expenseTotal', expenseTotal);
            }
        }
        
        function resetBudget() {
            if(confirm("ç¢ºå®šè¦é‡ç½®æ‰€æœ‰èŠ±è²»ç´€éŒ„å—ï¼Ÿ")) {
                expenseTotal = 0;
                document.getElementById('budget-display').innerText = "0";
                localStorage.setItem('expenseTotal', 0);
            }
        }

        function openTipsModal() {
            // é€™è£¡æ¨¡æ“¬é–‹å•Ÿä¸€å€‹å¹«åŠ©å¡ç‰‡
            openEventModalByRef('day1', 0); 
        }

        function openSubPage(id) { document.getElementById('subpage-' + id).classList.add('open'); }
        function closeSubPage(id) { document.getElementById('subpage-' + id).classList.remove('open'); }
        function sendSafety() { window.open(`https://wa.me/?text=${encodeURIComponent("æˆ‘å·²æŠµé”æ›¼è°·å®‰å…¨ä½ç½®ï¼Œä¸€åˆ‡å¹³å®‰ï¼")}`); }

        init();
    </script>
</body>
</html>
